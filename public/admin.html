<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Gabriel</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="chatContainer">
    <h2>Painel do Gabriel (Admin)</h2>
    <div id="chatArea">
      <div id="messages"></div>
      <form id="form">
        <input type="text" id="msg" placeholder="Digite sua resposta..." autocomplete="off" />
        <button type="submit" id="sendBtn">âž¤</button>
      </form>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    socket.emit("adminJoin");

    const messagesDiv = document.getElementById("messages");
    const form = document.getElementById("form");
    const input = document.getElementById("msg");

    let currentNickname = "";

    function horaAgora() {
      const now = new Date();
      return now.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" });
    }

    socket.on("adminHistory", ({ nickname, messages }) => {
      currentNickname = nickname;
      messagesDiv.innerHTML = ""; // limpa

      messages.forEach((m) => {
        const div = document.createElement("div");
        div.className = "msg " + (m.nickname === "Gabriel" ? "user" : "other");
        div.innerHTML = `<div class="meta">${m.nickname} - ${m.time}</div>${m.text}`;
        messagesDiv.appendChild(div);
      });

      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    socket.on("adminMessage", ({ from, toNickname, text, time }) => {
      if (toNickname !== currentNickname) return;

      const div = document.createElement("div");
      div.className = "msg other";
      div.innerHTML = `<div class="meta">${from} - ${time}</div>${text}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text || !currentNickname) return;

      socket.emit("adminReply", { toNickname: currentNickname, text });

      const div = document.createElement("div");
      div.className = "msg user";
      div.innerHTML = `<div class="meta">Gabriel - ${horaAgora()}</div>${text}`;
      messagesDiv.appendChild(div);

      input.value = "";
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  </script>
</body>
</html>
